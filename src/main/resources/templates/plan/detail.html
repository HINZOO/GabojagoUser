<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Í≤åÏãúÌåê ÏÉÅÏÑ∏</title>
    <link th:href="@{/public/css/plan/plan.css}" rel="stylesheet" />

</head>

<div layout:fragment="content" class="container-fluid px-0">
        <div class="row">

            <!--    ÏÇ¨Ïù¥ÎìúÎ∞î -->
            <div class="col-md-2" >
                <div class="row row-cols-1 sideGrid">
                    <div class="col titleBox">
                        <span th:text="${plan.getTitle()}"/>
                    </div>
                    <div class="col calenderBox">
                        <th:block th:include="/plan/calender"></th:block>
                    </div>

                    <div class="col infoBox">
                            <!--   <div class="infoImg" th:if="${plan.getImgPath()!=null}" th:style="'background-image:url(' +  + ');'"></div>-->
                            <img class="infoImg" th:if="${plan.getImgPath()!=null}" th:src="${plan.getImgPath()}"></img>
                            <img class="infoImg" th:if="${plan.getImgPath()==null}" src="/public/img/plan/planDefault.jpeg"></img>
                            <div class="infoStatus" >
                                <i class="bi bi-key"></i>
                                <span th:text="${plan.getPlanStatus()}"/></div>

                            <div class="infoSchedule">üóìÔ∏è <span th:text="${plan.getPlanFrom()}"/> ~ <span th:text="${plan.getPlanTo()}"/></div>

                        </div>


                </div>

            </div> <!--Ï¢åÏ∏°ÏÇ¨Ïù¥ÎìúÎã´Í∏∞-->



            <div class="col-md-8 mainSection">

                <div class="row mainHeader" style="margin-top: 20px ">
                    <div class="col-md-10">
                        <div class="btn-group btn-group-horizon btnLine" role="group">
                            <!--Î≥¥Í¥ÄÌï®-->
                            <button class="btn-group btn-group-vertical"  type="button" id="loadBtn">
                                <i class="bi bi-folder2-open"></i>
                            </button>
                            <!-- ÏßÄÏö∞Í∏∞ -->
                            <button class="btn-group btn-group-vertical"  type="button"  id="removeBtn">
                                <i class="bi bi-trash"></i>
                            </button>
                            <!--ÏÑ†ÌÉù-->
                            <button class="btn-group btn-group-vertical" type="button" id="selectorBtn">
                                <i class="bi bi-hand-index"></i>
                            </button>
                            <!--Ïù¥Îèô-->
                            <button class="btn-group btn-group-vertical" type="button"  id="moveBtn" style="background-color: #5d5d5d">
                                <i class="bi bi-arrows-move"></i>
                            </button>
                            <!--Ìéú-->
                            <button class="btn-group btn-group-vertical"  type="button" id="penBtn">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <!--ÏßÅÏÑ†-->
                            <button class="btn-group btn-group-vertical"  type="button" id="lineBtn" >
                                <i class="bi bi-slash-lg"></i>
                            </button>
                            <!--Î∞ïÏä§ -->
                            <button class="btn-group btn-group-vertical"  type="button"  id="rectBtn">
                                <i class="bi bi-square"></i>
                            </button>
                            <!--ÌÖçÏä§Ìä∏ÏûÖÎ†•-->
                            <button class="btn-group btn-group-vertical" type="button"  id="textBtn" style="background-color: #5d5d5d">
                                <i class="bi bi-fonts"></i>
                            </button>
                            <!--ÌååÎ†àÌä∏-->
                            <button class="btn-group btn-group-vertical"  type="button"   id="palateBtn" style="background-color: #5d5d5d">
                                <i class="bi bi-palette"></i>
                            </button>
                            <!--Ìè¨Ïä§Ìä∏Ïûá-->
                            <button class="btn-group btn-group-vertical"  type="button"  id="postBtn" style="background-color: #5d5d5d">
                                <i class="bi bi-sticky"></i>
                            </button>
                            <!--Ïä§ÌÖúÌîÑ-->
                            <button class="btn-group btn-group-vertical"  type="button" id="stampBtn" style="background-color: #5d5d5d">
                                <i class="bi bi-star"></i>
                            </button>
                            <!--ÏÑ§Ï†ï-->
                            <button class="btn-group btn-group-vertical"  type="button"  id="settingBtn" style="background-color: #5d5d5d">
                                <i class="bi bi-gear"></i>
                            </button>
                            <!--ÌîåÎü¨Ïä§Î≤ÑÌäº-->
                            <button class="btn-group btn-group-vertical"  type="button"  id="plusBtn">
                                <i class="bi bi-plus-circle"></i>
                            </button>
                            <!--ÎßàÏù¥ÎÑàÏä§Î≤ÑÌäº-->
                            <button class="btn-group btn-group-vertical"  type="button"  id="minusBtn">
                                <i class="bi bi-dash-circle"></i>
                            </button>
<!--                            <button class="btn-group btn-group-vertical red" ></button>-->
<!--                            <button class="btn-group btn-group-vertical orange"></button>-->
<!--                            <button class="btn-group btn-group-vertical yellow"></button>-->
<!--                            <button class="btn-group btn-group-vertical green"></button>-->
<!--                            <button class="btn-group btn-group-vertical blue"></button>-->
<!--                            <button class="btn-group btn-group-vertical navy"></button>-->
<!--                            <button class="btn-group btn-group-vertical purple"></button>-->
<!--                            <button class="btn-group btn-group-vertical black"></button>-->
<!--                            <button class="btn-group btn-group-vertical white"></button>-->
<!--                            <button class="btn-group btn-group-vertical clear"></button>-->

                            </div><!--Î≤ÑÌäºÍ∑∏Î£πÎã´Í∏∞-->
                        </div> <!--col 9-->

                    <div class="col-md-2 scheduleInputBox">
                        <div class="dropdown scheduleInput">
                            <button class="btn btn-secondary" id="newScheduleBtn">
                                ÏùºÏ†ïÏ∂îÍ∞Ä
                            </button>
                        </div>
                    </div>
                </div>


                    <div class="accordion .accordion-flush" id="accordionSection">
                        <div class="accordion-item" th:each="content:${plan.getContents()}">
                            <th:block th:include="/plan/contents"></th:block>
                        </div>
                    </div>

            </div> <!--Î©îÏù∏ÏÑπÏÖòÎã´Í∏∞-->


            <div class="col-md-2">
                <div class="row row-cols-1 sideGrid">
                    <div class="col memberBox">
                        <div class="memberTitle sideTitle">MEMBER</div>
                        <div class="memberContent sideContent">              </div>
                    </div>
                    <div class="col todoListBox">
                        <div class="todoListTitle sideTitle">CHECK_LIST</div>
                        <div class="todoListContent sideContent">Ìà¨ÎëêÎ¶¨ ÎÇ¥Ïö©</div>
                    </div>

                </div>
            </div> <!--Ïö∞Ï∏°ÏÇ¨Ïù¥Îìú Îã´Í∏∞-->




    </div> <!--Í∑∏Î¶¨Îìú row Îã´Í∏∞-->

<!--ÏÉà ÌîåÎûú Î™®Îã¨ Î∂ÄÎ∂Ñ-->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary bg-opacity-10">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">ÏÉà Ïä§ÏºÄÏ•¥ ÏûëÏÑ±</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form  method="post" id="scheduleInsertForm">
                        <div class="row">
                            <div class="col-6">
                                <div class="row">
                                    <div class="col-12 mb-3">
                                        <div class="form-floating">
<!--                                            <input type="text" class="form-control" name="pId" th:value="${plan.getPId()}"  id="floatingId" placeholder="" hidden>-->
                                            <input type="text" class="form-control" name="pId" value="1"  id="floatingId" placeholder="" hidden>
                                            <label for="floatingId"></label>
                                        </div>
                                    </div>
                                    <div class="col-12 mb-3">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" name="tId" value="" id="tId" placeholder="" hidden>
                                            <label for="tId"></label>
                                        </div>
                                    </div>
                                    <div class="col-12 mb-3">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" name="sId" value="" id="sId" placeholder="" hidden>
                                            <label for="sId"></label>
                                        </div>
                                    </div>
                                    <div class="col-12 mb-3">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" name="title" id="floatingTitle" placeholder="">
                                            <label for="floatingTitle">Ïó¨ÌñâÏßÄ</label>
                                        </div>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" name="info" id="info" placeholder="">
                                            <label for="info">Í≤ΩÏú†ÏßÄ</label>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-floating">
                                            <input type="time" class="form-control" name="time" id="time" placeholder="">
                                            <label for="time">ÏãúÍ∞Ñ</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-floating">
                                    <input type="" class="form-control" name="" id="floatingImg" placeholder="">
                                    <label for="floatingImg">Î∂ÅÎßàÌÅ¨ÎÑ£ÏùÑÎ∂ÄÎ∂Ñ</label>
                                </div>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">ÎßåÎì§Í∏∞</button>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </div>



    <script th:inline="javascript">
        let bb = document.getElementsByClassName("scheduleLeft")
        Array.from(bb).forEach((e)=>{
            e.addEventListener("click",()=>{
                console.log("ÎêòÎÇò?")
            })
        })

        /*
        Í≤åÏãúÍ∏ÄÏùÑ Î°úÎìú Ìï† Îïå ÌôîÎ©¥ Ï¥àÍ∏∞Ìôî
        Ïä§ÏºÄÏ•¥Ïù¥ Ï∂îÍ∞ÄÎêòÍ≥† Í∑∏Î¶ºÌåêÍπåÏßÄ ÎßåÎì† Í≤ΩÏö∞ÏôÄ, Í∑∏Î¶ºÌåêÏùÄ ÎßåÎì§ÏßÄ ÏïäÏùÄ Í≤ΩÏö∞Î•º Íµ¨Î∂ÑÌïòÏó¨ Ï≤òÎ¶¨
         */
        document.addEventListener("DOMContentLoaded",()=>{
            let initArr=[];
            let nBtns = document.querySelectorAll(".newCanvasBtn");
            [# th:each="c,s:${plan.getContents()}"]
            if([[${c.getPath()}]]!=null) initArr.push([[${c.getPath()}]])
            [/];
            initArr.forEach((a)=>{
               let ele = document.querySelector(`#content_${a.conId}`).lastElementChild;
                newCanvas(ele,a.conId,a.canPath);
            });
        });

        // ÏõπÏÜåÏºìÏö©
        const URL="ws://localhost:7777/plan"
        let webSocket;
        webSocket=new WebSocket(URL);


        // ÏÉà Ïä§ÏºÄÏ•¥ Îì±Î°ù Î™®Îã¨
        const newScheduleBtn = document.querySelector("#newScheduleBtn");
        newScheduleBtn.addEventListener("click",()=>{
            new bootstrap.Modal(document.getElementById('staticBackdrop'),{}).show();
        });

        // ÏÉà Ïä§ÏºÄÏ•¥ Ï†úÏ∂úÏãú
        const scheduleInsertForm = document.getElementById("scheduleInsertForm");
        scheduleInsertForm.onsubmit=registerSchedule;



        //ÏÉà Ïä§ÏºÄÏ•¥ ÏÉùÏÑ±Ïãú @ResponseBody ÏöîÏ≤≠ Î≥¥ÎÇ¥Í≥† Í≤∞Í≥ºÏóê Îî∞Îùº ÏΩúÎû©Ïä§ ÏÉùÏÑ±...ÎÇòÏ§ëÏóê
        async function registerSchedule(e){
            e.preventDefault();
            const data=new FormData(scheduleInsertForm);
            let url="/plan/contents/insert.do"
            const resp=await fetch(url,{method:"POST",body:data});
            if(resp.status===200){
                const json=await resp.json();
                if(true){
                    alert(JSON.stringify(json));
                }
            }else {
                alert("Îì±Î°ù Ïã§Ìå® status :"+resp.status);
            }
        }




        function newCanvas(ele,conId,path=null){
            let w = document.querySelector(".accordion-item").clientWidth;
            let h = 500/1200*w+16; //16ÏùÄ Î∂ÄÌä∏Ïä§Ìä∏Îû© ÏïÑÏΩîÎîîÏñ∏Î∞îÎîîÏóê ÏÑ§Ï†ïÎêú ÏÉÅÌïò Ìå®Îî©Í∞íÏùÑ Î≥¥Ï†ïÌï¥Ï§Ä Í≤É
            ele.style.height = h +"px";
            let newCanvas = new CanvasCreate(conId, path);
            let canvas = newCanvas.canvas;
            ele.lastElementChild.style.display = "none"
            ele.append(canvas);
        }

        async function newCanvasBtn(ele){
            let conId = ele.parentElement.getAttribute("id").split("_")[1]
            let url =`/plan/contents/canvasHandler.do`
            const resp = await fetch(url,{method:"POST",body:conId});
            const result = await resp.json();
            if(resp.status===200 && result===1){
                newCanvas(ele, conId);
            }else {
                alert("Ï∫îÎ≤ÑÏä§ ÏÉùÏÑ± Ïã§Ìå® status :"+resp.status);
            }
        }







    </script>

    <script type="text/javascript" th:src="@{/public/js/plan/canvasFunction.js}"></script>
</div> <!--Î†àÏù¥ÏïÑÏõÉ Îã´Í∏∞-->
</html>

