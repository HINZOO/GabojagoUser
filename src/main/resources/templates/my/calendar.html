<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layoutMy}">
<div layout:fragment="content" class="container pb-5">
  <style>
    a { color:#000000;text-decoration:none; }
    .scriptCalendar { text-align:center; }
    .scriptCalendar > thead > tr > td { width:50px;height:50px; }
    .scriptCalendar > thead > tr:first-child > td { font-weight:bold; }
    .scriptCalendar > thead > tr:last-child > td { background-color:#90EE90; }
    .scriptCalendar > tbody > tr > td { width:50px;height:50px; }
    .calendarBtn { cursor:pointer; }
  </style>

<div>
  <h3>출석체크</h3>
  <p th:text="${session.loginUser.uId}"></p>
  <a class="btn btn-outline-primary" th:onclick="attendanceChk([[${session.loginUser.uId}]])">출석체크</a>
  <br/>
  <script>
  async function attendanceChk(uId){
    const today = new Date();
    const year = today.getFullYear();
    const month = ('0' + (today.getMonth() + 1)).slice(-2);
    const day = ('0' + today.getDate()).slice(-2);
    const dateString = `${year}-${month}-${day}`

      let url=`/my/${uId}/${dateString}/handler.do`
      const resp=await fetch(url,{method:"POST"})
      if(resp.status===200){
        let status=await resp.text();
        return status;
      }else if(resp.status===400){
        alert("로그인 하셔야 이용할 수 있는 서비스 입니다.")
      }else if(resp.status===500){
        alert("이미 출석체크가 되었거나 오류가 발생했으니 새로고침하고 다시 시도하세요.")
      }
  }
</script>
</div>
</html>